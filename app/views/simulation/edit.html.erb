<script type="text/javascript">
	$(document).ready(function(){
		
		var client = new XMLHttpRequest();

		// GET JSON FILE
		client.open('GET', 'https://dl.dropboxusercontent.com/s/yyimks43gemdazq/jsonFile.json?dl=1&token_hash=AAEwKPu9isScXrMb-m9dVvUkYjxLiZTsM2DcEiIvPbXFnQ',false);
		client.send();
		var jsonText = client.responseText;
		
		// GET XPDL FILE
		client.open('GET', 'https://dl.dropboxusercontent.com/s/j1w6mr83r8ug0om/simpleWorkflow.xpdl?dl=1&token_hash=AAH7PHIpUBmIim-BUM6uC7WC8lAqG-36HYOqxJHkbm2WzA',false);
		client.send();
		var XPDLText = client.responseText;
		
		// CREATE THE JAVASCRIPT OBJECT BASED ON THE JSON FILE
		var jsonObject = JSON.parse(jsonText);
	
		var alreadyLoaded = false;
	
		$.ajax({
			beforeSend: function(req) {
				req.setRequestHeader("Accept", "application/json");
			},
			url: "/workflow/xpdltojson", 
			type: "POST",
			success: function(data) {
				if(!alreadyLoaded){
					var bpmn = new net.BpmnJS($('#canvas')[0], []);
					bpmn.plot(jsonObject);
					alreadyLoaded = true;
				}
			}
		});
		
		$('#canvas').on( "click", "circle", function() {
			$('#addData').modal('show');
		});
		
		$('#canvas').on( "click", "rect", function() {
			$('#addData').modal('show');
		});
		
	});
</script>

<h1><%= @simulation.name %></h1>

<hr>

<div class="row">
	<div id="canvas" style="border:1px solid lightgrey; margin:5px;"></div>
</div>

<button type="button" class="btn btn-primary">Save Simulation</button>
<button type="button" class="btn btn-primary">Run</button>

<div class="modal fade" id="addData" role="dialog" aria-labelledby="addDataModalLabel" aria-hidden="true" style="display:none">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="addDataModalLabel">Add Mock Data</h4>
            </div>

            <div class="modal-body">
                <div class="form-container">
                    <div class="key_val row">
						<div class="col-md-5">
							<div class="formLabel">
								<label for="key">Key</label>
							</div>
							<div class="formField">
								<input name="key" type="text" class="form-control" />
							</div>
						</div>
						<div class="col-md-5">
							<div class="formLabel">
								<label for="value">Value</label>
							</div>
							<div class="formField">
								<input name="value" type="text" class="form-control" />
							</div>
						</div>
						<div class="col-md-2">
							<div class="formLabel">
								<label for="buttons"></label>
							</div>
							<div class="btn-group">
								<button class="btn btn-success add_data">+</button>
								<button class="btn btn-danger remove_data">-</button>
							</div>
						</div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="save" type="button" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>

        </div>
    </div>
</div>
